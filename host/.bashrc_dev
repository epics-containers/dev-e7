#!/bin/bash

#################### EXAMPLE ################################################### 

# personal .bashrc_dev for setting up environment in developer containers

# prompt: adds 'IOC' for generic IOC containers and 'dev-u22' for the workspace
# container
function parse_git_branch {
    git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1) /'
}
if [[ -d /repos/epics/ioc ]]; then
    PS1="\[\e[32m\]\$(parse_git_branch)\[\e[m\][\[\e[34m\]IOC\[\e[m\] \W]\$ "
else
    PS1="\[\e[32m\]\$(parse_git_branch)\[\e[m\][\[\e[34m\]dev-u22\[\e[m\] \W]\$ "
fi
if [[ -f /etc/centos-release ]] ; then
    PS1="[C7] ${PS1}"
fi
export PS1

# point at your cluster config file
export KUBECONFIG=/home/giles/.kube/config_pollux
# the default beamline for ec commands
export K8S_BEAMLINE=bl45p
# where to get HELM charts for ec commands
export K8S_HELM_REGISTRY=ghcr.io/epics-containers
# where to get container IMAGES for ec commands
export K8S_IMAGE_REGISTRY=ghcr.io/epics-containers
# the URL for the facility graylog
export K8S_GRAYLOG_URL=https://graylog2.diamond.ac.uk
# set this to True to supress output of commands in 'ec' CLI
unset K8S_QUIET

# enable autossh proxy - remove this if not required
if not pgrep autossh; then
  echo "Starting autossh"
  nohup autossh -N -D9090 -o ServerAliveInterval=10 hgv27681@ssh.diamond.ac.uk > /tmp/autossh.log &
fi
